{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth" id="html-root">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>{% block title %}ErrandExpress ðŸš€ - Smart Errands. Trusted Students.{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸš€</text></svg>">

    <!-- Tailwind CSS with Fallback -->
    <script src="https://cdn.tailwindcss.com" onerror="loadTailwindFallback()"></script>
    <script>
        // Fallback for Tailwind CSS if CDN fails
        function loadTailwindFallback() {
            console.warn('Primary Tailwind CDN failed, loading fallback...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/tailwindcss@3.3.5/dist/tailwind.min.js';
            script.onerror = function () {
                console.error('Tailwind CSS failed to load. Using basic styles.');
            };
            document.head.appendChild(script);
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.469.0/dist/umd/lucide.min.js"></script>
    <script>
        // Initialize Lucide icons when library loads
        function initLucideIcons() {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            } else {
                // Retry if not loaded yet
                setTimeout(initLucideIcons, 100);
            }
        }

        // Initialize on script load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initLucideIcons);
        } else {
            initLucideIcons();
        }
    </script>

    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Custom Tailwind Configuration -->
    <script>
        // Wait for Tailwind to load before configuring
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        fontFamily: {
                            'poppins': ['Poppins', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                            'inter': ['Inter', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                        },
                        colors: {
                            'primary': '#3B82F6',
                            'primary-600': '#2563EB',
                            'mint': '#22C55E',
                            'accent': '#FACC15',
                            'bg': '#F9FAFB',
                            'text-primary': '#111827',
                            'muted': '#6B7280',
                            'danger': '#EF4444',
                            'card': '#ffffff',
                        },
                        borderRadius: {
                            'xl2': '1rem',
                        },
                        boxShadow: {
                            'card': '0 6px 20px rgba(13, 38, 59, 0.08)',
                            'card-hover': '0 12px 30px rgba(59, 130, 246, 0.12)',
                        },
                        animation: {
                            'float': 'float 6s ease-in-out infinite',
                            'glow': 'glow 2s ease-in-out infinite alternate',
                            'slide-up': 'slideUp 0.5s ease-out',
                            'fade-in': 'fadeIn 0.3s ease-in',
                            'scale-in': 'scaleIn 0.2s ease-out',
                            'bounce-gentle': 'bounceGentle 0.6s ease-out',
                        },
                        keyframes: {
                            float: {
                                '0%, 100%': { transform: 'translateY(0px)' },
                                '50%': { transform: 'translateY(-10px)' },
                            },
                            glow: {
                                '0%': { boxShadow: '0 0 5px #3B82F6' },
                                '100%': { boxShadow: '0 0 20px #3B82F6, 0 0 30px #3B82F1' },
                            },
                            slideUp: {
                                '0%': { transform: 'translateY(20px)', opacity: '0' },
                                '100%': { transform: 'translateY(0)', opacity: '1' },
                            },
                            fadeIn: {
                                '0%': { opacity: '0' },
                                '100%': { opacity: '1' },
                            },
                            scaleIn: {
                                '0%': { transform: 'scale(0.95)', opacity: '0' },
                                '100%': { transform: 'scale(1)', opacity: '1' },
                            },
                            bounceGentle: {
                                '0%': { transform: 'scale(0.3)' },
                                '50%': { transform: 'scale(1.05)' },
                                '70%': { transform: 'scale(0.9)' },
                                '100%': { transform: 'scale(1)' },
                            }
                        }
                    }
                }
            };
        }
    </script>

    <!-- Global Styles -->
    <style>
        :root {
            --color-primary: #3B82F6;
            --color-primary-600: #2563EB;
            --color-mint: #22C55E;
            --color-accent: #FACC15;
            --bg: #F9FAFB;
            --text-primary: #111827;
            --muted: #6B7280;
            --danger: #EF4444;
            --card: #ffffff;
        }

        .dark {
            --bg: #0F172A;
            --text-primary: #F1F5F9;
            --muted: #94A3B8;
            --card: #1E293B;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        /* Component Classes */
        .btn-primary {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            border-radius: 1rem;
            color: white;
            font-weight: 500;
            background: linear-gradient(to right, #3B82F6, #4F46E5);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: scale(1.01);
        }

        .btn-ghost {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            border-radius: 1rem;
            color: #3B82F6;
            font-weight: 500;
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.2s;
        }

        .btn-ghost:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }

        .btn-icon {
            padding: 0.5rem;
            border-radius: 0.75rem;
            color: #6B7280;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            color: #3B82F6;
            background-color: rgba(59, 130, 246, 0.05);
        }

        .card {
            background-color: white;
            border-radius: 1rem;
            padding: 1.25rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.2s;
        }

        .card-hover:hover {
            transform: scale(1.02);
            transform: translateY(-0.25rem);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-primary {
            background-color: #EFF6FF;
            color: #3B82F6;
        }

        .badge-mint {
            background-color: #F0FDF4;
            color: #22C55E;
        }

        .badge-accent {
            background-color: #FEFCE8;
            color: #D97706;
        }

        .badge-danger {
            background-color: #FEF2F2;
            color: #EF4444;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #E5E7EB;
            outline: none;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.2);
        }

        /* Sidebar Styles */
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            color: #374151;
            font-weight: 500;
            transition: all 0.2s;
            background: white;
            border: 2px solid #f3f4f6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            text-decoration: none;
            min-height: 44px;
        }

        .sidebar-item:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            color: #3b82f6;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Table Styles */
        .table-row:hover {
            background-color: #F9FAFB;
            transition: background-color 0.15s;
        }

        /* Mobile Responsiveness Utilities */
        img,
        video {
            max-width: 100%;
            height: auto;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .table-responsive table {
            min-width: 600px;
        }

        /* Touch Targets */
        button,
        a.btn,
        .btn,
        a[href],
        input[type="button"],
        input[type="submit"] {
            min-height: 44px;
            min-width: 44px;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 575px) {
            body {
                font-size: 14px;
            }

            h1 {
                font-size: 1.75rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .container {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
        }

        @media (min-width: 576px) and (max-width: 767px) {
            .container {
                max-width: 540px;
            }
        }

        @media (min-width: 768px) and (max-width: 991px) {
            .container {
                max-width: 720px;
            }
        }

        @media (min-width: 992px) and (max-width: 1199px) {
            .container {
                max-width: 960px;
            }
        }

        @media (min-width: 1200px) {
            .container {
                max-width: 1140px;
            }
        }

        @media (max-width: 768px) {
            .mobile-stack {
                flex-direction: column !important;
            }

            .mobile-full {
                width: 100% !important;
            }

            .mobile-hide {
                display: none !important;
            }

            button,
            a.btn,
            .btn {
                min-height: 48px;
                padding: 0.875rem 1.25rem;
            }

            .card {
                margin-bottom: 1rem;
            }
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>

<body>
    {% if user.is_authenticated %}
    <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center gap-2">
                    <a href="{% url 'dashboard' %}" class="flex items-center gap-2 group">
                        <div
                            class="w-8 h-8 bg-gradient-to-br from-primary to-indigo-600 rounded-lg flex items-center justify-center transform group-hover:rotate-12 transition-transform duration-300">
                            <span class="text-white font-bold text-lg">E</span>
                        </div>
                        <span class="font-poppins font-bold text-xl gradient-text hidden sm:block">ErrandExpress</span>
                        <span class="text-xl">ðŸš€</span>
                    </a>
                </div>

                <!-- Spacer -->
                <div class="flex-1"></div>

                <!-- Right Actions -->
                <div class="flex items-center gap-3">
                    <!-- Quick Post Task -->
                    {% if user.role == 'task_poster' or user.role == 'admin' %}
                    <a href="{% url 'create_task' %}" class="btn-primary hidden sm:inline-flex text-sm">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Post Task
                    </a>
                    {% endif %}

                    <!-- Profile Menu -->
                    <div class="relative ml-2">
                        <button class="flex items-center gap-2 focus:outline-none" id="user-menu-button">
                            <div class="relative">
                                <div
                                    class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-indigo-600 flex items-center justify-center text-white font-bold shadow-md">
                                    <span class="text-xs">{{ user.fullname.0|upper }}</span>
                                </div>
                                <span
                                    class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-mint rounded-full ring-2 ring-white"></span>
                            </div>

                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    {% endif %}

    <!-- Mobile Navigation Bar -->
    {% if user.is_authenticated %}
    <nav
        class="lg:hidden bg-white border-b border-gray-200 sticky top-0 z-40 flex items-center justify-between gap-1 overflow-x-auto px-1 py-3 shadow-sm">
        <a href="{% url 'dashboard' %}"
            class="flex flex-col items-center gap-1 px-3 py-2 text-xs font-semibold text-gray-700 hover:text-primary rounded-xl">
            <div class="p-2 bg-blue-50 rounded-lg"><i data-lucide="home" class="w-5 h-5 text-primary"></i></div>
            <span class="text-gray-600">Home</span>
        </a>

        {% if user.role == 'task_poster' %}
        <a href="{% url 'create_task' %}"
            class="flex flex-col items-center gap-1 px-3 py-2 text-xs font-semibold text-gray-700 hover:text-primary rounded-xl">
            <div class="p-2 bg-green-50 rounded-lg"><i data-lucide="plus" class="w-5 h-5 text-green-600"></i></div>
            <span class="text-gray-600">Post</span>
        </a>
        {% else %}
        <a href="{% url 'browse_tasks' %}"
            class="flex flex-col items-center gap-1 px-3 py-2 text-xs font-semibold text-gray-700 hover:text-primary rounded-xl">
            <div class="p-2 bg-green-50 rounded-lg"><i data-lucide="search" class="w-5 h-5 text-green-600"></i></div>
            <span class="text-gray-600">Browse</span>
        </a>
        {% endif %}

        <a href="{% url 'messages_list' %}"
            class="flex flex-col items-center gap-1 px-3 py-2 text-xs font-semibold text-gray-700 hover:text-primary rounded-xl">
            <div class="p-2 bg-blue-50 rounded-lg"><i data-lucide="message-circle" class="w-5 h-5 text-primary"></i>
            </div>
            <span class="text-gray-600">Messages</span>
        </a>

        <a href="{% url 'notifications' %}"
            class="flex flex-col items-center gap-1 px-3 py-2 text-xs font-semibold text-gray-700 hover:text-primary rounded-xl relative">
            <div class="p-2 bg-orange-50 rounded-lg relative">
                <i data-lucide="bell" class="w-5 h-5 text-orange-600"></i>
                <span id="mobile-notification-badge"
                    class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden animate-pulse ring-1 ring-white">0</span>
            </div>
            <span class="text-gray-600">Alerts</span>
        </a>

        <a href="{% url 'profile' %}"
            class="flex flex-col items-center gap-1 px-3 py-2 text-xs font-semibold text-gray-700 hover:text-primary rounded-xl">
            <div class="p-2 bg-red-50 rounded-lg"><i data-lucide="user" class="w-5 h-5 text-red-600"></i></div>
            <span class="text-gray-600">Profile</span>
        </a>

        <a href="{% url 'logout' %}"
            class="flex flex-col items-center gap-1 px-3 py-2 text-xs font-bold text-white bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-md ml-auto">
            <div class="p-2 bg-red-400 rounded-lg"><i data-lucide="log-out" class="w-5 h-5 text-white"></i></div>
            <span class="text-white font-semibold">Logout</span>
        </a>
    </nav>
    {% endif %}

    <!-- Main Layout -->
    <div class="{% if user.is_authenticated %}layout grid{% endif %}">
        {% if user.is_authenticated %}
        <!-- Sidebar -->
        <aside
            class="sidebar w-72 bg-gradient-to-b from-gray-50 to-white border-r border-gray-200 fixed left-0 top-16 h-[calc(100vh-4rem)] z-30 hidden lg:block shadow-sm">
            <!-- Scrollable Content Area -->
            <div class="p-6 h-full overflow-y-auto pb-24">
                <!-- User Profile Card -->
                <div class="mb-6 p-4 bg-white rounded-xl shadow-sm border border-gray-100">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 bg-gradient-to-br from-primary to-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            {{ user.fullname|first|upper }}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-gray-900 truncate">{{ user.fullname }}</p>
                            <p class="text-xs text-gray-500">
                                {% if user.role == 'task_poster' %}Task Poster
                                {% elif user.role == 'task_doer' %}Task Doer
                                {% else %}{{ user.role|title }}{% endif %}
                            </p>
                        </div>
                    </div>

                    <!-- Quick Stats Mini -->
                    <div class="mt-3 pt-3 border-t border-gray-100 grid grid-cols-2 gap-2 text-center">
                        <div>
                            <div class="text-lg font-bold text-primary">{{ user_stats.tasks_completed }}</div>
                            <div class="text-xs text-gray-500">Tasks</div>
                        </div>
                        <div>
                            <div class="text-lg font-bold text-green-600">â‚±{{ user_stats.total_earned|floatformat:0 }}
                            </div>
                            <div class="text-xs text-gray-500">{% if user.role == 'task_doer' %}Earned{% else %}Spent{% endif %}</div>

                        </div>
                    </div>
                </div>

                <!-- Main Navigation -->
                <div class="mb-6">
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4 px-2">Menu</p>
                    <nav class="flex flex-col space-y-2">
                        <a href="{% url 'dashboard' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                            <i data-lucide="home" class="w-5 h-5"></i>
                            <span>Dashboard</span>
                        </a>

                        {% if user.role == 'task_poster' %}
                        <a href="{% url 'create_task' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'create_task' %}active{% endif %}">
                            <i data-lucide="plus-circle" class="w-5 h-5"></i>
                            <span>Post Task</span>
                        </a>
                        {% else %}
                        <a href="{% url 'browse_tasks' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'browse_tasks' %}active{% endif %}">
                            <i data-lucide="search" class="w-5 h-5"></i>
                            <span>Browse Tasks</span>
                        </a>
                        {% endif %}

                        <a href="{% url 'notifications' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'notifications' %}active{% endif %}"
                            id="sidebar-notifications-link">
                            <i data-lucide="bell" class="w-5 h-5"></i>
                            <span>Notifications</span>
                            {% if user_stats.unread_notifications_count > 0 %}
                            <span id="sidebar-notification-badge"
                                class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-semibold">{{ user_stats.unread_notifications_count }}</span>
                            {% endif %}
                        </a>

                        <a href="{% url 'my_tasks' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'my_tasks' %}active{% endif %}">
                            <i data-lucide="list-checks" class="w-5 h-5"></i>
                            <span>My Tasks</span>
                        </a>

                        <a href="{% url 'messages_list' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'messages_list' %}active{% endif %}">
                            <i data-lucide="message-circle" class="w-5 h-5"></i>
                            <span>Messages</span>
                            {% if user_stats.unread_messages_count > 0 %}
                            <span
                                class="ml-auto bg-red-500 text-white text-xs px-2 py-0.5 rounded-full font-semibold">{{ user_stats.unread_messages_count }}</span>
                            {% endif %}
                        </a>

                        <a href="{% url 'payments_dashboard' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'payments_dashboard' %}active{% endif %}">
                            <i data-lucide="wallet" class="w-5 h-5"></i>
                            <span>Payments</span>
                        </a>

                        <a href="{% url 'task_monitoring' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'task_monitoring' %}active{% endif %}">
                            <i data-lucide="chart-bar" class="w-5 h-5"></i>
                            <span>Monitoring</span>
                        </a>

                        {% if user.role == 'task_doer' or user.role == 'admin' %}
                        <a href="{% url 'skill_validation' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'skill_validation' %}active{% endif %}">
                            <i data-lucide="award" class="w-5 h-5"></i>
                            <span>Validate Skills</span>
                        </a>
                        {% endif %}

                        <a href="{% url 'profile' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                            <i data-lucide="user" class="w-5 h-5"></i>
                            <span>Profile</span>
                        </a>
                    </nav>
                </div>

                <!-- Admin Section -->
                {% if user.role == 'admin' %}
                <div class="mb-6">
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4 px-2">Admin</p>
                    <nav class="flex flex-col space-y-2">
                        <a href="{% url 'admin_dashboard' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
                            <i data-lucide="shield" class="w-5 h-5"></i>
                            <span>Admin Panel</span>
                        </a>
                        <a href="{% url 'system_wallet' %}"
                            class="sidebar-item {% if request.resolver_match.url_name == 'system_wallet' %}active{% endif %}">
                            <i data-lucide="wallet" class="w-5 h-5"></i>
                            <span>System Wallet</span>
                        </a>
                    </nav>
                </div>
                {% endif %}
            </div>

            <!-- Fixed Logout Button -->
            <div class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-white to-transparent">
                <a href="{% url 'logout' %}"
                    class="flex items-center justify-center gap-3 px-6 py-4 rounded-xl font-bold text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                    <i data-lucide="log-out" class="w-6 h-6"></i>
                    <span class="text-base">Logout</span>
                </a>
            </div>
        </aside>
        {% endif %}

        <!-- Main Content -->
        <main class="{% if user.is_authenticated %}content ml-0 lg:ml-72 min-h-screen{% else %}min-h-screen{% endif %}">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Django Messages -->
    {% include 'includes/django_messages.html' %}

    <!-- Notification System -->
    {% include 'includes/notifications.html' %}

    <!-- Loading Overlay -->
    <div id="loading-overlay"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl flex flex-col items-center gap-4">
            <div class="animate-spin rounded-full h-10 w-10 border-4 border-primary border-t-white"></div>
            <p class="text-gray-600 font-medium">Loading...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Initialize AOS
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 600,
                    easing: 'ease-out-cubic',
                    once: true
                });
            }
        });

        // Loading functionality
        function showLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            }
        }

        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }
        }

        // Add loading state to forms
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function () {
                if (!this.classList.contains('no-loading')) {
                    showLoading();
                }
            });
        });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>

</html>