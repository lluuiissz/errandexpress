{% extends "base_complete.html" %}
{% load static %}

{% block title %}My Profile - ErrandExpress{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 pb-20 relative overflow-hidden">

    <!-- Decorative Elements -->
    <div
        class="absolute top-0 right-0 w-96 h-96 bg-blue-400/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none">
    </div>
    <div
        class="absolute bottom-0 left-0 w-96 h-96 bg-indigo-400/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none">
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-10 relative z-10">

        <!-- Header Profile Card -->
        <div
            class="bg-white/70 backdrop-blur-xl border border-white/60 rounded-3xl p-8 shadow-xl shadow-slate-200/40 mb-8 relative overflow-hidden group hover:shadow-2xl transition-all duration-500">
            <div
                class="absolute inset-0 bg-gradient-to-r from-blue-500/5 to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500">
            </div>

            <div class="relative flex flex-col md:flex-row items-center md:items-start gap-8">
                <!-- Profile Picture -->
                <div class="relative group/avatar">
                    <div
                        class="absolute -inset-1 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full opacity-75 blur transition-opacity duration-500 group-hover/avatar:opacity-100">
                    </div>
                    {% if user.profile_picture %}
                    <img src="{{ user.profile_picture.url }}" alt="{{ user.fullname }}"
                        class="relative w-32 h-32 rounded-full object-cover border-4 border-white shadow-md">
                    {% else %}
                    <div
                        class="relative w-32 h-32 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center border-4 border-white shadow-md">
                        <span class="text-4xl font-black text-indigo-500">{{ user.fullname.0|upper }}</span>
                    </div>
                    {% endif %}

                    <button onclick="showProfilePictureModal()"
                        class="absolute bottom-1 right-1 w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center hover:bg-indigo-700 transition-all shadow-lg hover:scale-110 z-10 border-2 border-white">
                        <i data-lucide="camera" class="w-4 h-4"></i>
                    </button>
                </div>

                <!-- User Info -->
                <div class="flex-1 text-center md:text-left space-y-2">
                    <div class="flex flex-col md:flex-row items-center md:items-end gap-3 mb-1">
                        <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">{{ user.fullname }}</h1>
                        <span
                            class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider {% if user.role == 'task_poster' %}bg-blue-100 text-blue-700{% elif user.role == 'task_doer' %}bg-emerald-100 text-emerald-700{% else %}bg-purple-100 text-purple-700{% endif %}">
                            {{ user.get_role_display }}
                        </span>
                    </div>

                    <p class="text-slate-500 font-medium flex items-center justify-center md:justify-start gap-2">
                        <span>@{{ user.username }}</span>
                        <span class="w-1 h-1 rounded-full bg-slate-300"></span>
                        <span>{{ user.email }}</span>
                    </p>

                    <div class="flex flex-wrap items-center justify-center md:justify-start gap-3 pt-2">
                        <div
                            class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-slate-100/50 text-slate-600 text-sm font-medium border border-slate-200/50">
                            <i data-lucide="calendar" class="w-4 h-4 text-slate-400"></i>
                            Joined {{ user.date_joined|date:"M Y" }}
                        </div>
                        {% if user.campus_location %}
                        <div
                            class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-indigo-50/50 text-indigo-600 text-sm font-medium border border-indigo-100/50">
                            <i data-lucide="map-pin" class="w-4 h-4 text-indigo-500"></i>
                            {{ user.get_campus_location_display }}
                        </div>
                        {% endif %}
                    </div>

                    {% if user.bio %}
                    <p class="text-slate-600 max-w-2xl mt-4 leading-relaxed">{{ user.bio }}</p>
                    {% else %}
                    <p class="text-slate-400 italic mt-4 flex items-center justify-center md:justify-start gap-2">
                        <i data-lucide="pen-line" class="w-4 h-4"></i>
                        No bio added yet. Tell us about yourself!
                    </p>
                    {% endif %}
                </div>

                <!-- Quick Stats -->
                <div class="flex flex-row md:flex-col gap-4 min-w-[140px]">
                    <div
                        class="bg-indigo-50/50 rounded-2xl p-4 text-center border border-indigo-100 hover:bg-indigo-50 transition-colors">
                        <p class="text-2xl font-black text-indigo-600">{{ tasks_completed }}</p>
                        <p class="text-xs font-bold text-indigo-400 uppercase tracking-wide">Tasks Done</p>
                    </div>
                    <div
                        class="bg-emerald-50/50 rounded-2xl p-4 text-center border border-emerald-100 hover:bg-emerald-50 transition-colors">
                        <p class="text-2xl font-black text-emerald-600">
                            {% if user_rating > 0 %}
                            {{ user_rating }}
                            {% else %}
                            -
                            {% endif %}
                        </p>
                        <p class="text-xs font-bold text-emerald-400 uppercase tracking-wide">Rating</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-8">

            <!-- Left Column: Settings -->
            <div class="lg:col-span-2 space-y-8">

                <!-- Personal Info Form -->
                <div
                    class="bg-white/70 backdrop-blur-xl border border-white/60 rounded-3xl p-8 shadow-lg shadow-slate-200/40 relative overflow-hidden">
                    <div class="flex items-center justify-between mb-8">
                        <h2 class="text-xl font-bold text-slate-900 flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-blue-100 text-blue-600 flex items-center justify-center shadow-sm">
                                <i data-lucide="user-cog" class="w-5 h-5"></i>
                            </div>
                            Personal Information
                        </h2>
                        <button onclick="toggleEdit('personal-info')"
                            class="text-sm font-bold text-indigo-600 hover:text-indigo-700 bg-indigo-50 hover:bg-indigo-100 px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                            <i data-lucide="edit-3" class="w-4 h-4"></i>
                            Edit Details
                        </button>
                    </div>

                    <!-- Display Mode -->
                    <div id="personal-info-display" class="space-y-6">
                        <div class="grid sm:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Full
                                    Name</label>
                                <p class="text-lg font-medium text-slate-900">{{ user.fullname }}</p>
                            </div>
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Phone</label>
                                <p class="text-lg font-medium text-slate-900">{{ user.phone_number|default:"Not set" }}
                                </p>
                            </div>
                            <div class="space-y-2 sm:col-span-2">
                                <label class="text-xs font-bold text-slate-400 uppercase tracking-wider">Campus
                                    Location</label>
                                <p class="text-lg font-medium text-slate-900 flex items-center gap-2">
                                    <i data-lucide="building" class="w-4 h-4 text-slate-400"></i>
                                    {{ user.get_campus_location_display|default:"Not set" }}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Edit Mode (Hidden) -->
                    <form id="personal-info-form" method="POST" action="{% url 'profile' %}"
                        class="hidden space-y-6 mt-6 pt-6 border-t border-slate-100">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="update_profile">

                        <div class="grid sm:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-700">Full Name</label>
                                <input type="text" name="fullname" value="{{ user.fullname }}"
                                    class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium text-slate-900">
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-700">Phone Number</label>
                                <input type="tel" name="phone" value="{{ user.phone_number|default:'' }}"
                                    class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium text-slate-900">
                            </div>
                            <div class="space-y-2 sm:col-span-2">
                                <label class="text-sm font-bold text-slate-700">Campus Location</label>
                                <div class="relative">
                                    <i data-lucide="chevron-down"
                                        class="absolute right-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"></i>
                                    <select name="campus_location"
                                        class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium text-slate-900 appearance-none">
                                        <option value="">Select your campus college...</option>
                                        {% for value, name in CAMPUS_CHOICES %}
                                        {% if user.campus_location == value %}
                                        <option value="{{ value }}" selected>{{ name }}</option>
                                        {% else %}
                                        <option value="{{ value }}">{{ name }}</option>
                                        {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="space-y-2 sm:col-span-2">
                                <label class="text-sm font-bold text-slate-700">Bio</label>
                                <textarea name="bio" rows="3"
                                    class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium text-slate-900 resize-none">{{ user.bio|default:'' }}</textarea>
                            </div>
                        </div>

                        <div class="flex items-center gap-3">
                            <button type="submit"
                                class="px-6 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200">Save
                                Changes</button>
                            <button type="button" onclick="toggleEdit('personal-info')"
                                class="px-6 py-3 bg-white text-slate-600 font-bold rounded-xl hover:bg-slate-50 border border-slate-200 transition-colors">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Recent Activity -->
                <div
                    class="bg-white/70 backdrop-blur-xl border border-white/60 rounded-3xl p-8 shadow-lg shadow-slate-200/40">
                    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-3 mb-6">
                        <div
                            class="w-10 h-10 rounded-xl bg-violet-100 text-violet-600 flex items-center justify-center shadow-sm">
                            <i data-lucide="activity" class="w-5 h-5"></i>
                        </div>
                        Recent Activity
                    </h2>

                    <div class="space-y-4">
                        {% for task in recent_tasks %}
                        <div
                            class="group flex items-start gap-4 p-4 rounded-2xl bg-white/50 border border-white/60 hover:bg-white hover:shadow-md transition-all duration-300">
                            <div
                                class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0 {% if task.status == 'completed' %}bg-emerald-100/50 text-emerald-600{% elif task.status == 'in_progress' %}bg-blue-100/50 text-blue-600{% else %}bg-amber-100/50 text-amber-600{% endif %}">
                                <i data-lucide="{% if task.status == 'completed' %}check-circle-2{% elif task.status == 'in_progress' %}clock{% else %}circle-dot{% endif %}"
                                    class="w-6 h-6"></i>
                            </div>

                            <div class="flex-1 min-w-0">
                                <h3
                                    class="font-bold text-slate-900 truncate group-hover:text-indigo-600 transition-colors">
                                    {{ task.title }}</h3>
                                <div class="flex items-center gap-3 text-sm text-slate-500 mt-1">
                                    <span
                                        class="px-2 py-0.5 rounded-md text-xs font-bold uppercase tracking-wide {% if task.status == 'completed' %}bg-emerald-100 text-emerald-700{% elif task.status == 'in_progress' %}bg-blue-100 text-blue-700{% else %}bg-amber-100 text-amber-700{% endif %}">
                                        {{ task.get_status_display }}
                                    </span>
                                    <span class="font-semibold text-slate-700">₱{{ task.price }}</span>
                                    <span>•</span>
                                    <span>
                                        {% if task.completed_at %}
                                        {{ task.completed_at|timesince }}
                                        {% elif task.accepted_at %}
                                        {{ task.accepted_at|timesince }}
                                        {% else %}
                                        {{ task.created_at|timesince }}
                                        {% endif %}
                                        ago
                                    </span>
                                </div>
                            </div>

                            <a href="{% url 'task_detail' task.id %}"
                                class="self-center p-2 rounded-lg bg-slate-100 text-slate-400 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                                <i data-lucide="arrow-right" class="w-5 h-5"></i>
                            </a>
                        </div>
                        {% empty %}
                        <div
                            class="text-center py-12 px-4 rounded-2xl border-2 border-dashed border-slate-200 bg-slate-50/50">
                            <div class="flex justify-center mb-4">
                                <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center">
                                    <i data-lucide="ghost" class="w-8 h-8 text-slate-400"></i>
                                </div>
                            </div>
                            <h3 class="text-lg font-bold text-slate-900">No activity yet</h3>
                            <p class="text-slate-500 mb-6">Start your journey by posting or finding tasks.</p>
                            <a href="{% if user.role == 'task_poster' %}{% url 'create_task' %}{% else %}{% url 'browse_tasks' %}{% endif %}"
                                class="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors">
                                <i data-lucide="rocket" class="w-5 h-5"></i>
                                Get Started
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Right Column: Sidebar -->
            <div class="space-y-8">

                <!-- Account Security -->
                <div
                    class="bg-white/70 backdrop-blur-xl border border-white/60 rounded-3xl p-8 shadow-lg shadow-slate-200/40">
                    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-3 mb-6">
                        <div
                            class="w-10 h-10 rounded-xl bg-rose-100 text-rose-600 flex items-center justify-center shadow-sm">
                            <i data-lucide="shield-check" class="w-5 h-5"></i>
                        </div>
                        Security
                    </h2>

                    <div class="space-y-4">
                        <div
                            class="flex items-center justify-between p-4 rounded-2xl bg-white/50 border border-white/60">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center shrink-0">
                                    <i data-lucide="lock" class="w-5 h-5 text-slate-500"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-slate-900 text-sm">Password</p>
                                    <p class="text-xs text-slate-500">Last changed recently</p>
                                </div>
                            </div>
                            <button onclick="showChangePassword()"
                                class="text-xs font-bold text-indigo-600 hover:text-indigo-700 hover:underline">
                                Change
                            </button>
                        </div>

                        <div
                            class="flex items-center justify-between p-4 rounded-2xl bg-white/50 border border-white/60">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center shrink-0">
                                    <i data-lucide="mail-check" class="w-5 h-5 text-emerald-600"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-slate-900 text-sm">Email</p>
                                    <p class="text-xs text-slate-500">Verified</p>
                                </div>
                            </div>
                            <i data-lucide="check-circle-2" class="w-5 h-5 text-emerald-500"></i>
                        </div>
                    </div>
                </div>

                <!-- Verified Skills (Doer Only) -->
                {% if user.role == 'task_doer' or user.role == 'admin' %}
                <div
                    class="bg-white/70 backdrop-blur-xl border border-white/60 rounded-3xl p-8 shadow-lg shadow-slate-200/40">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-slate-900 flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-amber-100 text-amber-600 flex items-center justify-center shadow-sm">
                                <i data-lucide="award" class="w-5 h-5"></i>
                            </div>
                            Skills
                        </h2>
                        <a href="{% url 'skill_validation' %}"
                            class="w-8 h-8 rounded-lg bg-amber-50 text-amber-600 flex items-center justify-center hover:bg-amber-100 transition-colors">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                        </a>
                    </div>

                    <div class="space-y-3">
                        {% for skill in verified_skills %}
                        <div
                            class="flex items-center justify-between p-3 rounded-xl bg-amber-50/50 border border-amber-100">
                            <div class="flex items-center gap-3">
                                <i data-lucide="check-circle-2" class="w-5 h-5 text-amber-500"></i>
                                <div>
                                    <p class="font-bold text-slate-900 text-sm">{{ skill.get_skill_name_display }}</p>
                                    {% if skill.test_score %}
                                    <p class="text-xs text-amber-700 font-medium">Score: {{ skill.test_score }}%</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <p
                            class="text-sm text-slate-500 italic text-center py-4 bg-slate-50 rounded-xl border border-dashed border-slate-200">
                            No verified skills yet.</p>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Quick Actions -->
                <div
                    class="bg-gradient-to-br from-indigo-600 to-blue-700 rounded-3xl p-8 shadow-xl shadow-indigo-200 text-white relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -translate-y-1/2 translate-x-1/2">
                    </div>

                    <h2 class="text-xl font-bold mb-6 flex items-center gap-3 relative z-10">
                        <div class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center backdrop-blur-sm">
                            <i data-lucide="zap" class="w-5 h-5 text-yellow-300"></i>
                        </div>
                        Quick Actions
                    </h2>

                    <div class="space-y-3 relative z-10">
                        <a href="{% url 'dashboard' %}"
                            class="flex items-center gap-3 p-3 rounded-xl bg-white/10 hover:bg-white/20 border border-white/10 hover:border-white/20 transition-all group">
                            <i data-lucide="home"
                                class="w-5 h-5 text-indigo-200 group-hover:text-white transition-colors"></i>
                            <span class="font-semibold">Dashboard</span>
                        </a>
                        {% if user.role == 'task_poster' or user.role == 'admin' %}
                        <a href="{% url 'create_task' %}"
                            class="flex items-center gap-3 p-3 rounded-xl bg-white/10 hover:bg-white/20 border border-white/10 hover:border-white/20 transition-all group">
                            <i data-lucide="plus-circle"
                                class="w-5 h-5 text-indigo-200 group-hover:text-white transition-colors"></i>
                            <span class="font-semibold">Post New Task</span>
                        </a>
                        {% endif %}
                        {% if user.role == 'task_doer' or user.role == 'admin' %}
                        <a href="{% url 'browse_tasks' %}"
                            class="flex items-center gap-3 p-3 rounded-xl bg-white/10 hover:bg-white/20 border border-white/10 hover:border-white/20 transition-all group">
                            <i data-lucide="search"
                                class="w-5 h-5 text-indigo-200 group-hover:text-white transition-colors"></i>
                            <span class="font-semibold">Browse Tasks</span>
                        </a>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Modal Backdrop -->
<div id="modal-backdrop"
    class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden z-40 transition-opacity duration-300 opacity-0"
    onclick="closeAllModals()"></div>

<!-- Profile Picture Modal -->
<div id="profile-picture-modal" class="fixed inset-0 hidden items-center justify-center z-50 pointer-events-none p-4">
    <div
        class="bg-white rounded-3xl p-8 max-w-sm w-full shadow-2xl shadow-indigo-900/20 transform scale-95 opacity-0 transition-all duration-300 pointer-events-auto relative overflow-hidden">
        <div class="absolute top-0 right-0 p-4">
            <button onclick="closeModal('profile-picture-modal')"
                class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
            </button>
        </div>

        <h3 class="text-xl font-bold text-slate-900 mb-6 text-center">Update Profile Photo</h3>

        <form method="POST" action="{% url 'profile' %}" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_profile">

            <div class="flex justify-center">
                {% if user.profile_picture %}
                <img src="{{ user.profile_picture.url }}"
                    class="w-32 h-32 rounded-full object-cover border-4 border-indigo-50 shadow-inner">
                {% else %}
                <div
                    class="w-32 h-32 rounded-full bg-slate-100 flex items-center justify-center border-4 border-white shadow-inner">
                    <i data-lucide="user" class="w-12 h-12 text-slate-300"></i>
                </div>
                {% endif %}
            </div>

            <div class="relative">
                <input type="file" name="profile_picture" id="photo-upload" accept="image/*" class="hidden"
                    onchange="document.getElementById('upload-btn-text').innerText = this.files[0].name">
                <label for="photo-upload"
                    class="flex flex-col items-center justify-center gap-2 p-6 rounded-2xl border-2 border-dashed border-slate-200 hover:border-indigo-500 hover:bg-indigo-50/50 transition-all cursor-pointer group">
                    <i data-lucide="upload-cloud"
                        class="w-8 h-8 text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                    <span id="upload-btn-text"
                        class="text-sm font-medium text-slate-600 group-hover:text-indigo-600">Click to upload
                        image</span>
                </label>
            </div>

            <div class="flex gap-3">
                <button type="submit"
                    class="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200">Save</button>
                {% if user.profile_picture %}
                <button type="button" onclick="deleteProfilePicture()"
                    class="px-4 py-3 bg-rose-50 text-rose-600 font-bold rounded-xl hover:bg-rose-100 transition-colors">
                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                </button>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<!-- Change Password Modal -->
<div id="change-password-modal" class="fixed inset-0 hidden items-center justify-center z-50 pointer-events-none p-4">
    <div
        class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl shadow-indigo-900/20 transform scale-95 opacity-0 transition-all duration-300 pointer-events-auto">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-slate-900">Change Password</h3>
            <button onclick="closeModal('change-password-modal')"
                class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
            </button>
        </div>

        <form method="POST" action="{% url 'profile' %}" class="space-y-4">
            {% csrf_token %}
            <input type="hidden" name="action" value="change_password">

            <div class="space-y-2">
                <label class="text-sm font-bold text-slate-700">Current Password</label>
                <input type="password" name="current_password" required
                    class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium">
            </div>

            <div class="space-y-2">
                <label class="text-sm font-bold text-slate-700">New Password</label>
                <input type="password" name="new_password" required
                    class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium">
            </div>

            <div class="space-y-2">
                <label class="text-sm font-bold text-slate-700">Confirm New Password</label>
                <input type="password" name="confirm_password" required
                    class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:bg-white focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 transition-all font-medium">
            </div>

            <div class="pt-4 flex gap-3">
                <button type="submit"
                    class="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-200">Update
                    Password</button>
                <button type="button" onclick="closeModal('change-password-modal')"
                    class="px-6 py-3 bg-white text-slate-600 font-bold rounded-xl hover:bg-slate-50 border border-slate-200 transition-colors">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
    });

    function toggleEdit(section) {
        const display = document.getElementById(`${section}-display`);
        const form = document.getElementById(`${section}-form`);

        if (display && form) {
            display.classList.toggle('hidden');
            form.classList.toggle('hidden');
        }
    }

    function openModalAnimation(modalId) {
        const backdrop = document.getElementById('modal-backdrop');
        const modal = document.getElementById(modalId);
        const modalContent = modal.querySelector('div');

        backdrop.classList.remove('hidden');
        setTimeout(() => backdrop.classList.remove('opacity-0'), 10); modal.classList.remove('hidden'); modal.classList.add('flex'); setTimeout(() => { modalContent.classList.remove('scale-95', 'opacity-0'); modalContent.classList.add('scale-100', 'opacity-100'); }, 10); } function closeModalAnimation(modalId) { const backdrop = document.getElementById('modal-backdrop'); const modal = document.getElementById(modalId); const modalContent = modal.querySelector('div'); modalContent.classList.remove('scale-100', 'opacity-100'); modalContent.classList.add('scale-95', 'opacity-0'); backdrop.classList.add('opacity-0'); setTimeout(() => { modal.classList.add('hidden'); modal.classList.remove('flex'); backdrop.classList.add('hidden'); }, 300); } function showProfilePictureModal() { openModalAnimation('profile-picture-modal'); } function showChangePassword() { openModalAnimation('change-password-modal'); } function closeModal(modalId) { closeModalAnimation(modalId); } function closeAllModals() { closeModalAnimation('profile-picture-modal'); closeModalAnimation('change-password-modal'); } function deleteProfilePicture() { if (confirm('Are you sure you want to remove your profile photo?')) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{% url "profile" %}';

            const csrf = document.createElement('input');
            csrf.type = 'hidden';
            csrf.name = 'csrfmiddlewaretoken';
            csrf.value = '{{ csrf_token }}';

            const action = document.createElement('input');
            action.type = 'hidden';
            action.name = 'action';
            action.value = 'delete_profile_picture';

            form.appendChild(csrf);
            form.appendChild(action);
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
{% endblock %}