{% extends "base_complete.html" %}
{% load static %}

{% block title %}Settings - ErrandExpress{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">⚙️ Settings</h1>
        <p class="text-gray-600">Manage your account preferences and settings</p>
    </div>

    <div class="grid lg:grid-cols-4 gap-6">
        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-2xl shadow-lg p-4 sticky top-24">
                <nav class="space-y-2">
                    <button onclick="showTab('account')" class="settings-tab active w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3" data-tab="account">
                        <i data-lucide="user" class="w-5 h-5"></i>
                        <span class="font-medium">Account</span>
                    </button>
                    <button onclick="showTab('notifications')" class="settings-tab w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3" data-tab="notifications">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                        <span class="font-medium">Notifications</span>
                    </button>
                    <button onclick="showTab('privacy')" class="settings-tab w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3" data-tab="privacy">
                        <i data-lucide="shield" class="w-5 h-5"></i>
                        <span class="font-medium">Privacy</span>
                    </button>
                    <button onclick="showTab('payments')" class="settings-tab w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3" data-tab="payments">
                        <i data-lucide="credit-card" class="w-5 h-5"></i>
                        <span class="font-medium">Payments</span>
                    </button>
                    <button onclick="showTab('preferences')" class="settings-tab w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3" data-tab="preferences">
                        <i data-lucide="sliders" class="w-5 h-5"></i>
                        <span class="font-medium">Preferences</span>
                    </button>
                    <button onclick="showTab('appearance')" class="settings-tab w-full text-left px-4 py-3 rounded-xl flex items-center space-x-3" data-tab="appearance">
                        <i data-lucide="palette" class="w-5 h-5"></i>
                        <span class="font-medium">Appearance</span>
                    </button>
                </nav>
            </div>
        </div>

        <!-- Content Area -->
        <div class="lg:col-span-3">
            <!-- Account Tab -->
            <div id="account-tab" class="settings-content bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i data-lucide="user" class="w-6 h-6 text-blue-600"></i>
                    Account Settings
                </h2>

                <form method="POST" action="{% url 'settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="section" value="account">

                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Personal Information</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                                <input type="text" name="fullname" value="{{ user.fullname }}" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" name="email" value="{{ user.email }}" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                                <input type="tel" name="phone" value="{{ user.phone|default:'' }}" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bio</label>
                                <textarea name="bio" rows="3" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">{{ user.bio|default:'' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8 pt-8 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Change Password</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                                <input type="password" name="current_password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                                <input type="password" name="new_password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
                                <input type="password" name="confirm_password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium flex items-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span>Save Changes</span>
                    </button>
                </form>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications-tab" class="settings-content hidden bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i data-lucide="bell" class="w-6 h-6 text-blue-600"></i>
                    Notification Settings
                </h2>

                <form method="POST" action="{% url 'settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="section" value="notifications">

                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Email Notifications</h3>
                        <div class="space-y-4">
                            <label class="flex items-center justify-between p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="briefcase" class="w-5 h-5 text-gray-600"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">New Task Matches</div>
                                        <div class="text-sm text-gray-500">Get notified when new tasks match your skills</div>
                                    </div>
                                </div>
                                <input type="checkbox" name="email_task_matches" checked class="w-5 h-5 text-blue-600 rounded">
                            </label>
                            <label class="flex items-center justify-between p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="message-circle" class="w-5 h-5 text-gray-600"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">Messages</div>
                                        <div class="text-sm text-gray-500">Receive email when you get a new message</div>
                                    </div>
                                </div>
                                <input type="checkbox" name="email_messages" checked class="w-5 h-5 text-blue-600 rounded">
                            </label>
                            <label class="flex items-center justify-between p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="credit-card" class="w-5 h-5 text-gray-600"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">Payment Updates</div>
                                        <div class="text-sm text-gray-500">Get notified about payment status changes</div>
                                    </div>
                                </div>
                                <input type="checkbox" name="email_payments" checked class="w-5 h-5 text-blue-600 rounded">
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium flex items-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span>Save Preferences</span>
                    </button>
                </form>
            </div>

            <!-- Privacy Tab -->
            <div id="privacy-tab" class="settings-content hidden bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i data-lucide="shield" class="w-6 h-6 text-blue-600"></i>
                    Privacy Settings
                </h2>
                <form method="POST" action="{% url 'settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="section" value="privacy">
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Profile Visibility</h3>
                        <div class="space-y-4">
                            <label class="flex items-center justify-between p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="eye" class="w-5 h-5 text-gray-600"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">Public Profile</div>
                                        <div class="text-sm text-gray-500">Allow others to view your profile</div>
                                    </div>
                                </div>
                                <input type="checkbox" name="profile_public" checked class="w-5 h-5 text-blue-600 rounded">
                            </label>
                            <label class="flex items-center justify-between p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="phone" class="w-5 h-5 text-gray-600"></i>
                                    <div>
                                        <div class="font-medium text-gray-900">Show Contact Info</div>
                                        <div class="text-sm text-gray-500">Display phone number on profile</div>
                                    </div>
                                </div>
                                <input type="checkbox" name="show_contact" class="w-5 h-5 text-blue-600 rounded">
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium flex items-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span>Save Settings</span>
                    </button>
                </form>
            </div>

            <!-- Payments Tab -->
            <div id="payments-tab" class="settings-content hidden bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i data-lucide="credit-card" class="w-6 h-6 text-blue-600"></i>
                    Payment Settings
                </h2>
                <form method="POST" action="{% url 'settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="section" value="payments">
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Payment Methods</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <label class="block text-sm font-medium text-gray-700 mb-2">GCash Number</label>
                                <input type="tel" name="gcash_number" placeholder="09XX XXX XXXX" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                    </div>
                    <div class="mb-8 pt-8 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Payment History</h3>
                        <a href="{% url 'payments_dashboard' %}" class="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100">
                            <div class="flex items-center gap-3">
                                <i data-lucide="history" class="w-5 h-5 text-gray-600"></i>
                                <span class="font-medium text-gray-900">View All Transactions</span>
                            </div>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                        </a>
                    </div>
                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium flex items-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span>Save Payment Info</span>
                    </button>
                </form>
            </div>

            <!-- Preferences Tab -->
            <div id="preferences-tab" class="settings-content hidden bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i data-lucide="sliders" class="w-6 h-6 text-blue-600"></i>
                    Task Preferences
                </h2>
                <form method="POST" action="{% url 'settings' %}">
                    {% csrf_token %}
                    <input type="hidden" name="section" value="preferences">
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Task Matching</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Maximum Distance (km)</label>
                                <input type="number" name="max_distance" value="10" min="1" max="50" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Minimum Payment (₱)</label>
                                <input type="number" name="min_payment" value="50" min="10" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-medium flex items-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        <span>Save Preferences</span>
                    </button>
                </form>
            </div>

            <!-- Appearance Tab with Dark Mode -->
            <div id="appearance-tab" class="settings-content hidden bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i data-lucide="palette" class="w-6 h-6 text-blue-600"></i>
                    Appearance Settings
                </h2>
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Theme</h3>
                    <div class="p-6 bg-gradient-to-r from-gray-900 to-gray-800 rounded-2xl">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center">
                                    <i data-lucide="moon" class="w-6 h-6 text-white"></i>
                                </div>
                                <div>
                                    <div class="font-semibold text-white">Dark Mode</div>
                                    <div class="text-sm text-gray-300">Reduce eye strain in low light</div>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dark-mode-toggle-settings" class="sr-only peer">
                                <div class="w-14 h-7 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <p class="text-sm text-gray-400">Toggle between light and dark themes. Your preference is saved automatically.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.settings-tab {
    transition: all 0.3s ease;
    color: #6b7280;
}
.settings-tab:hover {
    background-color: #f3f4f6;
    color: #1f2937;
}
.settings-tab.active {
    background-color: #3b82f6;
    color: white;
}
</style>

<script>
function showTab(tabName) {
    document.querySelectorAll('.settings-content').forEach(content => {
        content.classList.add('hidden');
    });
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.getElementById(tabName + '-tab').classList.remove('hidden');
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
}

document.addEventListener('DOMContentLoaded', function() {
    const darkModeToggle = document.getElementById('dark-mode-toggle-settings');
    if (darkModeToggle) {
        const isDarkMode = localStorage.getItem('darkMode') === 'enabled';
        darkModeToggle.checked = isDarkMode;
        darkModeToggle.addEventListener('change', function() {
            if (this.checked) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('darkMode', 'disabled');
            }
        });
    }
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
});
</script>
{% endblock %}