{% extends "base_complete.html" %}
{% load static %}

{% block title %}Post New Task - ErrandExpress{% endblock %}

{% block extra_css %}
<style>
    .step-container {
        @apply bg-white rounded-3xl p-8 shadow-lg border-2 border-gray-100 mb-8 transition-all duration-300;
    }
    .step-header {
        @apply flex items-center gap-4 mb-6 pb-6 border-b-2 border-gray-100;
    }
    .step-number {
        @apply w-14 h-14 bg-gradient-to-br from-blue-600 to-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-xl flex-shrink-0;
    }
    .step-title {
        @apply text-2xl font-bold text-gray-900;
    }
    .step-subtitle {
        @apply text-sm text-gray-500 mt-1;
    }
    .form-label {
        @apply block text-lg font-semibold text-gray-800 mb-3;
    }
    .form-input,
    .form-textarea,
    select {
        @apply w-full p-5 rounded-2xl border-3 border-gray-200 focus:border-blue-600 focus:ring-4 focus:ring-blue-500/20 outline-none transition-all duration-200 text-base font-medium;
    }
    .form-textarea {
        @apply min-h-[140px] resize-none;
    }
    .form-hint {
        @apply text-sm text-gray-600 mt-2 flex items-start gap-2;
    }
    .form-hint i {
        @apply mt-0.5 flex-shrink-0;
    }
    .grid-2 {
        @apply grid grid-cols-1 md:grid-cols-2 gap-8;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-b from-gray-50 to-white pb-20 lg:pb-6">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="flex items-center gap-4">
                <div class="w-16 h-16 bg-white/20 rounded-3xl flex items-center justify-center">
                    <i data-lucide="plus-circle" class="w-8 h-8 text-white"></i>
                </div>
                <div>
                    <h1 class="text-4xl font-bold font-poppins">Post Your Task</h1>
                    <p class="text-blue-100 mt-2 text-lg">Follow these simple steps to find the perfect helper</p>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <!-- Error Messages -->
        {% if messages %}
        <div class="mb-8 space-y-3">
            {% for message in messages %}
            <div class="{% if message.tags %}{{ message.tags }}{% else %}bg-blue-50 border-2 border-blue-200{% endif %} rounded-2xl p-5">
                <div class="flex items-start gap-3">
                    <i data-lucide="{% if 'error' in message.tags %}alert-circle{% elif 'success' in message.tags %}check-circle{% else %}info{% endif %}" class="w-6 h-6 {% if 'error' in message.tags %}text-red-600{% elif 'success' in message.tags %}text-green-600{% else %}text-blue-600{% endif %} mt-0.5 flex-shrink-0"></i>
                    <p class="{% if 'error' in message.tags %}text-red-700{% elif 'success' in message.tags %}text-green-700{% else %}text-blue-700{% endif %} font-semibold text-base">{{ message }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Form Errors -->
        {% if form.non_field_errors %}
        <div class="mb-8 bg-red-50 border-2 border-red-200 rounded-2xl p-5">
            <div class="flex items-start gap-3">
                <i data-lucide="alert-circle" class="w-6 h-6 text-red-600 mt-0.5 flex-shrink-0"></i>
                <div>
                    <h3 class="font-bold text-red-800 mb-3 text-base">Form Errors</h3>
                    <ul class="text-sm text-red-700 space-y-2">
                        {% for error in form.non_field_errors %}
                        <li class="flex items-start gap-2"><span class="text-red-600 font-bold">•</span> {{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% endif %}

        <form method="POST" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}
            
            <!-- STEP 1: What is your task? -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div>
                        <h2 class="step-title">What do you need done?</h2>
                        <p class="step-subtitle">Give your task a clear, descriptive title</p>
                    </div>
                </div>
                <div>
                    <label class="form-label">Task Title *</label>
                    {{ form.title }}
                    {% if form.title.errors %}
                    <div class="mt-3 text-sm text-red-600 font-semibold">
                        {% for error in form.title.errors %}<p>{{ error }}</p>{% endfor %}
                    </div>
                    {% endif %}
                    <div class="form-hint">
                        <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-500"></i>
                        <span><strong>Example:</strong> "Type 10-page research paper on climate change" or "Create 15-slide PowerPoint presentation"</span>
                    </div>
                </div>
            </div>

            <!-- STEP 2: Category & Tags -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div>
                        <h2 class="step-title">Choose category and tags</h2>
                        <p class="step-subtitle">Help doers find your task faster</p>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label class="form-label">Category *</label>
                        {{ form.category }}
                        {% if form.category.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.category.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    <div>
                        <label class="form-label">Tags (Optional)</label>
                        {{ form.tags }}
                        {% if form.tags.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.tags.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                        <div class="form-hint">
                            <i data-lucide="tag" class="w-5 h-5 text-blue-500"></i>
                            <span>Add keywords like "urgent", "research", "academic"</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: Description & Requirements -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div>
                        <h2 class="step-title">Describe the work in detail</h2>
                        <p class="step-subtitle">Be specific so doers understand exactly what you need</p>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="form-label">Description *</label>
                        {{ form.description }}
                        {% if form.description.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.description.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                        <div class="form-hint">
                            <i data-lucide="file-text" class="w-5 h-5 text-blue-500"></i>
                            <span>Include format requirements, style preferences, and any examples</span>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Special Requirements (Optional)</label>
                        {{ form.requirements }}
                        {% if form.requirements.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.requirements.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                        <div class="form-hint">
                            <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                            <span><strong>Example:</strong> "Must have PowerPoint 2019+", "APA format required", "Fast typing speed (50+ WPM)"</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 4: Price & Payment -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div>
                        <h2 class="step-title">Set price and payment method</h2>
                        <p class="step-subtitle">Choose how much you'll pay and how you'll pay</p>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label class="form-label">Price (₱) *</label>
                        {{ form.price }}
                        {% if form.price.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.price.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                        <div class="form-hint">
                            <i data-lucide="trending-up" class="w-5 h-5 text-green-500"></i>
                            <span>Fair pricing (₱50-500) attracts quality doers</span>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Payment Method *</label>
                        {{ form.payment_method }}
                        {% if form.payment_method.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.payment_method.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                        <div class="form-hint">
                            <i data-lucide="credit-card" class="w-5 h-5 text-blue-500"></i>
                            <span><strong>GCash:</strong> Instant • <strong>COD:</strong> Pay on completion</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 5: Deadline & Location -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div>
                        <h2 class="step-title">Set deadline and location</h2>
                        <p class="step-subtitle">When and where the work will be done</p>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label class="form-label">Deadline *</label>
                        {{ form.deadline }}
                        {% if form.deadline.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.deadline.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                        <div class="form-hint">
                            <i data-lucide="calendar" class="w-5 h-5 text-orange-500"></i>
                            <span>Set realistic deadlines (2-7 days) for quality results</span>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Location (Optional)</label>
                        {{ form.location }}
                        {% if form.location.errors %}
                        <div class="mt-3 text-sm text-red-600 font-semibold">
                            {% for error in form.location.errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                        {% endif %}
                        <div class="form-hint">
                            <i data-lucide="map-pin" class="w-5 h-5 text-red-500"></i>
                            <span>Where the work will be done (if applicable)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Final Action -->
            <div class="step-container bg-gradient-to-r from-blue-50 via-indigo-50 to-purple-50 border-2 border-blue-300">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="send" class="w-10 h-10 text-white"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Ready to Post?</h2>
                    <p class="text-gray-700 text-lg">Review everything and click "Post Task" to find your perfect helper!</p>
                </div>
                <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                    <a href="{% url 'dashboard' %}" class="btn-ghost w-full sm:w-auto px-8 py-4 text-lg">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        Cancel
                    </a>
                    <button type="submit" class="btn-primary w-full sm:w-auto px-8 py-4 text-lg">
                        <i data-lucide="send" class="w-5 h-5"></i>
                        Post Task Now
                    </button>
                </div>
                <p class="text-center text-sm text-gray-600 mt-6">
                    <i data-lucide="shield-check" class="w-5 h-5 inline mr-2 text-green-500"></i>
                    <span class="font-semibold">Your task will be reviewed and posted within minutes</span>
                </p>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Initialize Lucide icons
    if (typeof lucide !== 'undefined' && lucide.createIcons) {
        lucide.createIcons();
    }
</script>
{% endblock %}
